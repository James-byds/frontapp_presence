<form action="" id="checkin" class="checkin" method ="post">
  <label for="firstname"><input type="text" name="firstname" id="firstname" placeholder="PrÃ©nom"> </label>
  <label for="lastname"><input type="text" name="lastname" id="lastname" placeholder="Nom"> </label>
  <label for="email"><input type="email" name="email" id="email" placeholder="Email"> </label>
  <select name="typeOfVisit" id="typeOfVisit" placeholder="Type de visite">
    <option value="staff" selected>Visite</option>
    <option value="formations">Formation</option>
  </select>
  <select name="choiceOfVisit" id="choiceOfVisit" placeholder="Choix de la visite">
    <script> //dynamic select options
      // This script will dynamically populate the upper select element
      //global variable
      const form= document.querySelector('#checkin');
      const typeOfVisitSelect = form.querySelector('#typeOfVisit');
      let typeOfVisit = typeOfVisitSelect.value;
      const choiceOfVisitSelect = form.querySelector('#choiceOfVisit');
      //init api request
      let apiUrl = 'http://localhost/presence/cms/api/content/items/'+typeOfVisit; // Replace with your API URL

      typeOfVisitSelect.addEventListener('change', function() { 
        /*switch (typeOfVisitSelect.value) {
          case ('staff'):
            choiceOfVisitSelect.innerHTML = ''; // Clear previous options
            choiceOfVisitSelect.innerHTML = `
              <option value="visite1">Visite 1</option>
              <option value="visite2">Visite 2</option>
              <option value="visite3">Visite 3</option>
            `;
            break;
        
          case ('formation'):

            choiceOfVisitSelect.innerHTML = `
              <option value="formation1">Formation 1</option>
              <option value="formation2">Formation 2</option>
              <option value="formation3">Formation 3</option>
            `;
            break;
        }*/
       choiceOfVisitSelect.innerHTML = ''; // Clear previous options
        //fetch api data based on typeOfVisitSelect value
        typeOfVisit = typeOfVisitSelect.value;
        apiUrl = 'http://localhost/presence/cms/api/content/items/'+typeOfVisit; // Update API URL based on selection
         // Fetch data from the API
        console.log('Fetching data from:', apiUrl);
         fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            // Assuming data is an array of visit objects
            data.forEach(visit => {
              const option = document.createElement('option');
              option.classList.add('classoption');
              option.value = visit._id;
              option.textContent = visit.name; // name property subject to changes
            });
          })
          .catch(error => console.error('Error fetching visits:', error));
      });
      typeOfVisitSelect.dispatchEvent(new Event('change'));// Trigger change event on page load
    </script>
    </select>
  <input type="submit" value="Check In">
  <input type="reset" value="Reset">
  <script>//create new user and entry checkin
    //api send data
    form.addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent the default form submission
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      const user = {//data sent to api user model
        firstname: data.firstname,
        lastname: data.lastname,
        email: data.email
      };

      const today = new Date()//get checkin time
      //get current date in format dd/mm/yyyy
      //getcurrent hh:mm
      const currentTime = today.toLocaleTimeString(
        'fr-FR', // French locale
        { hour: '2-digit', minute: '2-digit' }
      );
      const day =today.toLocaleDateString(
        'fr-FR', // French locale
        { year: 'numeric', month: '2-digit', day: '2-digit' }
      );

      //configure entry type based on typeOfVisit to match api values
      const entry_type = data.typeOfVisit="staff" ? "Visit" : "Formation";
      console.log("date"+day+" hour: "+currentTime);

      const entry = {//data sent to api entry model
        entry_type: entry_type, // "Visit" or "Formation"
        choiceOfVisit: data.choiceOfVisit,
        date: day, //date in dd/mm/yyyy format
        arrival: currentTime, //hour of arrival
        user: user // Reference to the user object
      };

      let apiUrl = "http://localhost/presence/cms/api/content/item/entries"; // Replace with your API URL
      console.log('Sending data to:', apiUrl);
      console.log('Data:', entry); 
      /*fetch(apiUrl, { 
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        alert('Check-in successful!');
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('Check-in failed. Please try again.');
      });*/
    });
  </script>
</form>